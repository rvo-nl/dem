var scalefactor = 100,assetslog = {}
let sankeyLayout,sankeyDiagram,sankeyCanvas,headerCanvas,footerCanvas,autoPlayTimer,nodesGlobal,globalScaleInit,scaleValues,scaleDataValue_jaarbasis,scaleDataValue_uurbasis,sankeyData = {links: [],nodes: [],order: []},activeScenario = 0,scaleInit = 1,autoPlayStatus = !1,zoomHasInitialized = !1,helicopterMarkers = [],currentK = 1,helicopterLabelsPreviousValues = {},initScenarioSwitchFlag = 2,masterDivDynamicSankeyID = 'dynSankey',viewMode = 'jaarbasis',helicopterMarkerScaleValue = 2.5,shiftHelicopterMarkers_x = 0,shiftHelicopterMarkers_y = 0,initFlagSankey = !0
var dynamicSankeyLayout = d3.sankey().extent([[200, 130], [2e3 * scalefactor, 1200 * scalefactor]]),dynamicSankeyDiagram = d3.sankeyDiagram().nodeTitle((function (t) {return t.title || t.id})).linkColor((function (t) {return t.color}))
function updateDynamicSankey (t) {try {var e = JSON.parse(t)
    d3.select('#error').text('')} catch(t) {return void d3.select('#error').text(t) }dynamicSankeyLayout.ordering(e.order || null), alignLinkTypes(tryLayout, e.alignLinkTypes), d3.select('#dynamicSankey svg').datum(dynamicSankeyLayout.scale(null)(e)).transition().duration(speed - 50).ease(d3.easeLinear).call(dynamicSankeyDiagram)}function drawDynamicSankey (t, e) {return new Promise((a => {
    let n = e.links,r = e.nodes,l = e.legend,o = e.settings
    for (nodesGlobal = r, t.settings = o, t.legend = l, globalScaleInit = o[0].scaleInit, scaleValues = o[0].scaleDataValue_uurbasis, scaleDataValue = t.settings[0].scaleDataValue_uurbasis, i = 0;i < n.length;i++)Object.keys(n[i]).forEach((t => {
        'number' == typeof n[i][t] && (n[i][t] = n[i][t] / scaleValues)}));let d = 0
    r.forEach((t => {
      t.column > d && (d = t.column)}));let c = d + 1
    for (i = 0;i < c;i++)sankeyData.order.push([[]]); for (i = 0;i < r.length;i++) for (j = 0;j < sankeyData.order.length;j++)if (r[i].column == j) { for (0 == sankeyData.order[j].length && sankeyData.order[j].push([]), k = 0;k < r[i].cluster;k++)sankeyData.order[j].includes(k) || sankeyData.order[j].push([]); for (0 == sankeyData.order[j][r[i].cluster].length && sankeyData.order[j][r[i].cluster].push([]), k = 0;k < r[i].row;k++)sankeyData.order[j][r[i].cluster].includes(k) || sankeyData.order[j][r[i].cluster].push([]);sankeyData.order[j][r[i].cluster][r[i].row].push(r[i].id)} for (i = 0;i < r.length;i++)sankeyData.nodes.push({title: r[i].title,id: r[i].id,direction: r[i].direction,index: i,dummy: r[i].dummy,x: r[i].x,y: r[i].y});let y = [],p = 0
    for (s = 0;s < Object.keys(n[0]).length;s++)Object.keys(n[0])[s].includes('scenario') && (p < 10 ? y.push({title: Object.keys(n[0])[s].slice(10),id: Object.keys(n[0])[s]}) : y.push({title: Object.keys(n[0])[s].slice(11),id: Object.keys(n[0])[s]}), p++); for (t.scenarios = y, i = 0;i < n.length;i++)sankeyData.links.push({index: i,source: n[i]['source.id'],target: n[i]['target.id'],hook: n[i].hook,color: u(n[i].legend, l),value: n[i].value,type: n[i].type,legend: n[i].legend}), y.forEach((t => {
        sankeyData.links[i][t.id] = n[i][t.id]}));adaptTotalHeight = t.settings[0].adaptTotalHeight;let g = document.getElementById(t.targetDIV).offsetWidth,f = document.getElementById(t.targetDIV).offsetHeight
    function u (t, e) { for (let a = 0;a < e.length;a++)if (e[a].id === t)return e[a].color;return console.log('WARNING: DID NOT FIND MATCHING LEGEND ENTRY - "' + t + '"'), 'black'}function h (t, e, a, i) {const n = document.createElement('span')
      n.style.fontSize = e, n.style.fontFamily = a, n.textContent = t, document.body.appendChild(n);const s = n.offsetWidth
      return document.body.removeChild(n), s}sankeyLayout = d3.sankey().extent([[o[0].horizontalMargin, o[0].verticalMargin], [g - o[0].horizontalMargin, f - o[0].verticalMargin]]), sankeyDiagram = d3.sankeyDiagram().nodeTitle((function (t) {return t.title})).linkColor((function (t) {return t.color})), function (t, e, a) {d3.select('#sankeySVG2').remove(), assetslog = {};let n = a.settings[0].scrollExtentWidth,s = a.settings[0].scrollExtentHeight,r = document.getElementById(a.targetDIV).offsetWidth,l = document.getElementById(a.targetDIV).offsetHeight
      d3.select('#' + a.targetDIV).append('div').attr('id', a.targetDIV + '_content-wrapper').style('position', 'relative').style('top', '0px').style('left', '0px').style('overflow', 'hidden').style('width', '100%').style('height', 'calc(100% - 40px'), d3.select('#' + a.targetDIV + '_content-wrapper').append('div').attr('id', 'content').style('width', r + 'px').style('min-height', '100%').style('height', l + 'px').style('background-color', ''), d3.select('#' + a.targetDIV).append('div').attr('id', a.targetDIV + '_footer').attr('class', 'footer').style('height', '40px').style('width', '100%').style('position', 'absolute').style('bottom', '0px').style('left', '0px').style('overflow', 'hidden').append('svg').attr('id', a.targetDIV + '_footerSVG').attr('width', r).attr('height', 40), d3.select('#content').append('svg').style('position', 'absolute').style('top', '0px').style('left', '0px').attr('id', 'sankeySVG2backdrop').attr('width', r + 'px').attr('height', l + 'px').style('pointer-events', 'none'), d3.select('#content').append('svg').style('position', 'absolute').attr('id', 'sankeySVG2PARENT').attr('width', n + 'px').attr('height', s + 'px').style('pointer-events', 'none').append('g').attr('id', 'sankeySVG2').style('pointer-events', 'all'), d3.select('#' + a.targetDIV).append('div').style('position', 'absolute').style('left', '10px').style('bottom', '50px').style('height', '21px').style('background-color', '#999').attr('id', 'huidigGetoond').style('pointer-events', 'none'), backdropCanvas = d3.select('#sankeySVG2backdrop'), sankeyCanvas = d3.select('#sankeySVG2'), footerCanvas = d3.select('#' + a.targetDIV + '_footerSVG').append('g'), parentCanvas = d3.select('#sankeySVG2PARENT').append('g'), sankeyCanvas.append('rect').attr('width', n).attr('height', s).attr('fill', '#ddd').style('opacity', .001).attr('id', 'coverRect');function o ({transform:t}) {const e = parseFloat(a.settings[0].initTransformX),n = parseFloat(a.settings[0].initTransformY),s = parseFloat(a.settings[0].initTransformK)
        var r = d3.zoomIdentity.translate(e + t.x, n + t.y).scale(s * t.k)
        for (d3.select('#sankeySVG2').attr('transform', r), i = 0;i < helicopterMarkers.length;i++)d3.select('#' + helicopterMarkers[i].id + '_group').attr('transform', 'scale(' + 1 / t.k * helicopterMarkerScaleValue + ')');currentK = 1 / t.k}d3.select('#coverRect').on('click', (t => {
        const [e, i] = d3.pointer(t)
        let n = parseInt(e.toFixed(2)) - parseInt(a.settings[0].offsetX),s = parseInt(i.toFixed(2)) - parseInt(a.settings[0].offsetY)
        console.log(`Clicked at (${n}, ${s})`)})), window.addEventListener('resize', (function (t) {d3.select('#backDropCanvasFill').attr('width', document.getElementById(a.targetDIV).offsetWidth).attr('height', document.getElementById(a.targetDIV).offsetWidth), d3.select('#sankeySVG2backdrop').attr('width', document.getElementById(a.targetDIV).offsetWidth).attr('height', document.getElementById(a.targetDIV).offsetWidth), d3.select('#' + a.targetDIV + '_buttonsSVG').attr('width', document.getElementById(a.targetDIV).offsetWidth)})), function () {d3.select('#sankeySVG2PARENT').call(d3.zoom().extent([[0, 0], [document.getElementById('sankeySVG2PARENT').getAttribute('width').slice(0, -2), document.getElementById('sankeySVG2PARENT').getAttribute('height').slice(0, -2)]]).scaleExtent([.5, 8]).on('zoom', o));const t = parseFloat(a.settings[0].initTransformX),e = parseFloat(a.settings[0].initTransformY),i = parseFloat(a.settings[0].initTransformK)
        var n = d3.zoomIdentity.translate(t, e).scale(i)
        d3.select('#sankeySVG2').attr('transform', n)}();scaleInit = 'nee' == a.settings[0].normalize.toLowerCase() ? a.settings[0].scaleInit : null;!function () {let t = a.settings[0].legendPositionTop,n = a.settings[0].legendPositionLeft,s = []
        for (i = 0;i < e.length;i++)s.push({label: e[i].id,color: e[i].color,width: h(e[i].id, '13px', a.settings[0].font) + 15 + 35});let r = 0
        for (i = 0;i < s.length;i++)footerCanvas.append('rect').attr('x', r + n).attr('y', t).attr('width', 15).attr('height', 15).attr('fill', s[i].color), footerCanvas.append('text').style('font-family', a.settings[0].fontFamily).attr('x', r + n + 25).attr('y', t + 15 / 1.4).style('font-size', '12px').text(s[i].label), r += s[i].width}()}(0, l, t), function () { for (d3.select('#dynSankeyButtonJaarbasis_text').attr('fill', 'white'), d3.select('#dynSankeyButtonUurbasis').attr('fill', 'white'), d3.select('#dynSankeyButtonUurbasis_text').attr('fill', '#536588'), d3.select('#clockDynamicSankey').style('visibility', 'hidden'), sankeyDiagramCurrentUnit = 'PJ', scaleDataValue = sankeyfyConfig.settings[0].scaleDataValue_jaarbasis, i = 0;i < sankeyData.links.length;i++)sankeyData.links[i].value = yearCumulatives[sankeyData.links[i].hook] / 1e6 * 3.6;updateDynamicSankey(JSON.stringify(sankeyData), sankeyfyConfig.settings[0].offsetX, sankeyfyConfig.settings[0].offsetY, sankeyfyConfig.settings[0].fontSize, sankeyfyConfig.settings[0].font)}(), a()}))}function updateDynamicSankey (t, e, a, i, n) {try {t = JSON.parse(t);d3.select('#error').text('')} catch(t) {return void d3.select('#error').text(t) }sankeyLayout.nodePosition((function (t) {return [t.x, t.y]}));let s = speed
  d3.select('#sankeySVG2').datum(sankeyLayout.scale(scaleInit)(t)).transition().duration(s).ease(d3.easeLinear).call(sankeyDiagram), d3.select('.sankey').attr('transform', 'translate(' + e + ',' + a + ')'), d3.selectAll('.node-title').style('font-size', i + 'tepx'), d3.selectAll('.link').style('pointer-events', 'all'), d3.selectAll('.node').style('pointer-events', 'all'), d3.selectAll('.node-backdrop-title').style('pointer-events', 'none'), d3.selectAll('.node-click-target').style('fill', '#555').style('stroke-width', 0).attr('width', 15).attr('rx', 0).attr('ry', 0).attr('transform', 'translate(-4,0)scale(1.000)'), d3.select('.sankey').select('.nodes').selectAll('.node').select('.node-click-target').attr('id', (function (t, e) {return 'nodeindex_' + t.index})).on('click', (function () {nodeVisualisatieSingular(config, sankeyData.nodes[this.id.slice(10)], sankeyData, config.scenarios, config.targetDIV)})), setTimeout((() => {
    helicopterMarkers = [], d3.selectAll('.helicopterLabel').remove(), drawHelicopterMarkersDynamicSankey({id: 'elektriciteit_main',aggregate: 'HELICOPTERMARKER_ELEKTRICITEIT',title: 'ELEKTRICITEIT',change: 30,color: '#FFB300'}), drawHelicopterMarkersDynamicSankey({id: 'waterstof_main',aggregate: 'HELICOPTERMARKER_WATERSTOF',title: 'WATERSTOF',change: 30,color: '#3c39cc'}), drawHelicopterMarkersDynamicSankey({id: 'methaan_main',aggregate: 'HELICOPTERMARKER_METHAAN',title: 'METHAAN',change: 30,color: '#64B5F6'}), drawHelicopterMarkersDynamicSankey({id: 'totaal_industrie',aggregate: 'HELICOPTERMARKER_INDUSTRIE',title: 'INDUSTRIE',change: 30,color: '#64B5F6'}), drawHelicopterMarkersDynamicSankey({id: 'totaal_go',aggregate: 'HELICOPTERMARKER_GEBOUWDEOMGEVING',title: 'GEB.OMGEVING',change: 30,color: '#64B5F6'}), drawHelicopterMarkersDynamicSankey({id: 'totaal_landbouw',aggregate: 'HELICOPTERMARKER_LANDBOUW',title: 'LANDBOUW',change: 30,color: '#64B5F6'}), drawHelicopterMarkersDynamicSankey({id: 'totaal_mobiliteit',aggregate: 'HELICOPTERMARKER_MOBILITEIT',title: 'MOBILITEIT',change: 30,color: '#64B5F6'}), drawHelicopterMarkersDynamicSankey({id: 'totaal_export',aggregate: 'HELICOPTERMARKER_EXPORT',title: 'EXPORT',change: 30,color: '#64B5F6'}), drawHelicopterMarkersDynamicSankey({id: 'totaal_import',aggregate: 'HELICOPTERMARKER_IMPORT',title: 'IMPORT',change: 30,color: '#64B5F6'}), drawHelicopterMarkersDynamicSankey({id: 'totaal_winning',aggregate: 'HELICOPTERMARKER_WINNING',title: 'WINNING',change: 30,color: '#64B5F6'}), initScenarioSwitchFlag > 0 && initScenarioSwitchFlag--}), s)}function drawHelicopterMarkersDynamicSankey (t) {if (index = nodesGlobal.findIndex((e => e.id === t.id)), 'uurbasis' === viewMode)t.value = aggregates[t.aggregate][timelinePosition]
  else if ('jaarbasis' === viewMode) {t.value = aggregates[t.aggregate].reduce(((t, e) => t + e), 0) / 277800}t.refX = nodesGlobal[index].x - 300 + shiftHelicopterMarkers_x, t.refY = nodesGlobal[index].y - 1e3 + shiftHelicopterMarkers_y, helicopterMarkers.push(t);let e = 'm480-123.807-252.769-252.77 20.384-21.538L465.346-180.5v-663.385h30.193V-180.5l216.846-218.115 21.269 22.038L480-123.807Z'
  sankeyCanvas.append('g').attr('id', t.id + '_group').attr('class', 'helicopterLabel');let a = d3.select('#' + t.id + '_group'),i = 250 + t.refX,n = 1100 + t.refY
  var s,r
  if (a.style('transform-origin', i + 'px ' + n + 'px'), d3.select('#' + t.id + '_group').attr('transform', 'scale(' + currentK * helicopterMarkerScaleValue + ')'), i = 178 + t.refX, n = 1100 + t.refY, 'uurbasis' === viewMode) {var l = (t.value / 1e3).toFixed(1)
    s = .96 * getTextWidth(t.title, '60px', sankeyfyConfig.settings[0].font) + 60, r = .96 * getTextWidth(l + 'GW', '60px', sankeyfyConfig.settings[0].font) + 60, a.append('path').attr('d', e).attr('transform', 'translate(' + i + ',' + n + ')scale(0.15)'), a.append('rect').attr('x', 260 - s + 10 + t.refX).attr('y', 850 + t.refY).attr('width', s).attr('height', 95).attr('fill', '#EEE').style('opacity', 1), a.append('text').attr('x', 240 + t.refX).attr('y', 920 + t.refY).attr('fill', '#000').style('font-size', '60px').style('text-anchor', 'end').style('font-weight', '400').text(t.title), a.append('rect').attr('x', 270 + t.refX).attr('y', 850 + t.refY).attr('width', r).attr('height', 95).attr('fill', '#333').style('opacity', .6), a.append('text').attr('x', 290 + t.refX).attr('y', 920 + t.refY).attr('fill', '#FFF').style('font-size', '60px').style('text-anchor', 'start').text(l + ' ' + sankeyDiagramCurrentUnit)}else 'jaarbasis' === viewMode && (s = .96 * getTextWidth(t.title, '60px', sankeyfyConfig.settings[0].font) + 60, r = .96 * getTextWidth(t.value.toFixed(1) + ' GW', '60px', sankeyfyConfig.settings[0].font) + 20, a.append('path').attr('d', e).attr('transform', 'translate(' + i + ',' + n + ')scale(0.15)'), a.append('rect').attr('x', 260 - s + 10 + t.refX).attr('y', 850 + t.refY).attr('width', s).attr('height', 95).attr('fill', '#EEE').style('opacity', 1), a.append('text').attr('x', 240 + t.refX).attr('y', 920 + t.refY).attr('fill', '#000').style('font-size', '60px').style('text-anchor', 'end').style('font-weight', '400').text(t.title), a.append('rect').attr('x', 270 + t.refX).attr('y', 850 + t.refY).attr('width', r).attr('height', 95).attr('fill', '#333').style('opacity', .6), a.append('text').attr('x', 290 + t.refX).attr('y', 920 + t.refY).attr('fill', '#FFF').style('font-size', '60px').style('text-anchor', 'start').text(t.value.toFixed(1) + ' ' + sankeyDiagramCurrentUnit));if (0 == initScenarioSwitchFlag) {i = t.refX - s - 110, n = 970 + t.refY;let e = 0
    if (helicopterLabelsPreviousValues[t.id] < t.value) {e = '+ ' + (t.value - helicopterLabelsPreviousValues[t.id]) + ' MWh'}if (helicopterLabelsPreviousValues[t.id] > t.value) {e = '- ' + (helicopterLabelsPreviousValues[t.id] - t.value) + ' MWh'}}helicopterLabelsPreviousValues[t.id] = t.value}function drawViewModeButtons () {const t = 300
  d3.select('#' + masterDivDynamicSankeyID).append('div').style('width', t + 'px').style('height', '70px').style('background-color', 'rgba(255,255,255,0.8)').style('position', 'absolute').style('top', '20px').style('right', '20px').style('z-index', 500).attr('id', 'dynSankeyViewmodeButtons'), d3.select('#dynSankeyViewmodeButtons').append('svg').attr('id', 'dynSankeyViewmodeButtons_SVG').style('width', t + 'px').style('height', '70px');var e = d3.select('#dynSankeyViewmodeButtons_SVG').append('g')
  e.append('rect').attr('width', 140).attr('height', 50).attr('x', 10).attr('y', 10).attr('fill', '#FFFFFF').attr('id', 'dynSankeyButtonUurbasis').style('stroke', '#536588').on('click', (function () {d3.select(this).attr('fill', '#536588'), d3.select('#dynSankeyButtonUurbasis_text').attr('fill', 'white'), d3.select('#dynSankeyButtonJaarbasis').attr('fill', 'white'), d3.select('#dynSankeyButtonJaarbasis_text').attr('fill', '#536588'), d3.select('#clockDynamicSankey').style('visibility', 'visible'), viewMode = 'uurbasis', sankeyDiagramCurrentUnit = 'GW', scaleDataValue = sankeyfyConfig.settings[0].scaleDataValue_uurbasis, timelinePosition -= 1, tick(), d3.select('#hintDynamicSankey').remove()})), e.append('text').attr('fill', '#FFFFFF').attr('font-size', '20px').attr('x', 75).attr('y', 40).text('Uurbasis').style('text-anchor', 'middle').attr('id', 'dynSankeyButtonUurbasis_text').style('pointer-events', 'none'), e.append('rect').attr('width', 140).attr('height', 50).attr('x', 150).attr('y', 10).attr('fill', '#536588').attr('id', 'dynSankeyButtonJaarbasis').style('stroke', '#536588').on('click', (function () { for (d3.select(this).attr('fill', '#536588'), d3.select('#dynSankeyButtonJaarbasis_text').attr('fill', 'white'), d3.select('#dynSankeyButtonUurbasis').attr('fill', 'white'), d3.select('#dynSankeyButtonUurbasis_text').attr('fill', '#536588'), d3.select('#clockDynamicSankey').style('visibility', 'hidden'), viewMode = 'jaarbasis', sankeyDiagramCurrentUnit = 'PJ', scaleDataValue = sankeyfyConfig.settings[0].scaleDataValue_jaarbasis, i = 0;i < sankeyData.links.length;i++)sankeyData.links[i].value = yearCumulatives[sankeyData.links[i].hook] / 1e6 * 3.6;updateDynamicSankey(JSON.stringify(sankeyData), sankeyfyConfig.settings[0].offsetX, sankeyfyConfig.settings[0].offsetY, sankeyfyConfig.settings[0].fontSize, sankeyfyConfig.settings[0].font)})), e.append('text').attr('fill', '#536588').attr('font-size', '20px').attr('x', 215).attr('y', 40).text('Jaarbasis').style('text-anchor', 'middle').attr('id', 'dynSankeyButtonJaarbasis_text').style('pointer-events', 'none')}function drawClockDynamicSankey () {d3.select('#' + masterDivDynamicSankeyID).append('div').attr('id', 'clockDynamicSankey').style('width', '170px').style('height', '40px').style('background-color', '#888').style('opacity', .8).style('position', 'absolute').style('top', '20px').style('left', '20px').style('z-index', 500), d3.select('#clockDynamicSankey').append('svg').attr('width', '200px').attr('height', '40px').style('position', 'relative').attr('id', 'clockSVG');let t = d3.select('#clockSVG').append('g')
  t.append('text').attr('x', 15).attr('y', 30).attr('fill', 'white').style('font-weight', 100).style('font-size', '25px').attr('id', 'clockHour').text('00:00'), t.append('text').attr('x', 110).attr('y', 30).attr('fill', 'white').style('font-weight', 100).style('font-size', '20px').text('00 °C')}function drawButtonHint () {d3.select('#' + masterDivDynamicSankeyID).append('div').attr('id', 'hintDynamicSankey').style('width', '370px').style('height', '40px').style('opacity', 1).style('position', 'absolute').style('top', '36px').style('right', '320px').style('z-index', 500), d3.select('#hintDynamicSankey').append('svg').attr('width', '370px').attr('height', '40px').style('background-color', 'rgba(255,255,255,0.8)').style('position', 'relative').attr('id', 'hintSVG');let t = d3.select('#hintSVG').append('g')
  t.append('path').attr('d', 'M687.692-327.692 659.154-356l104-104H160v-40h603.154L659.385-604l28.538-28.308L840-480 687.692-327.692Z').attr('transform', 'translate(310,45)scale(0.05)').attr('fill', 'black'), t.append('text').attr('x', 15).attr('y', 25).text("Klik op 'Uurbasis' voor animatie op uurbasis")}function wrap (t, e) {t.each((function () {var t,a = d3.select(this),i = a.text().split(/\s+/).reverse(),n = [],s = 0,r = a.attr('y'),l = parseFloat(a.attr('dy'))
    isNaN(l) && (l = 0); for (var o = a.text(null).append('tspan').attr('x', 10).attr('y', r).attr('dy', l + 'em');t = i.pop();)n.push(t), o.text(n.join(' ')), o.node().getComputedTextLength() > e && (n.pop(), o.text(n.join(' ')), n = [t], o = a.append('tspan').attr('x', 10).attr('y', 0).attr('dy', 1.8 * ++s + l + 'em').text(t))}))}drawViewModeButtons(), drawClockDynamicSankey(), drawButtonHint()
